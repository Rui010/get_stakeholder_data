# Get Stakeholder Data

## システム概要

EDINETから有価証券報告書を取得して、大株主の状況と役員一覧をパースして、DBに取り込む

## 機能一覧

1. EDINETから当日の有価証券報告書の文書番号一覧を取得する

   - 有価証券報告書（書類種別コード120、訂正含む）を対象とする
   - それ以外は対象外とする

2. EDINETから文書番号をキーにXBRLファイルを取得する

   - フォルダはxbrl_dataディレクトリにコードごとに格納する
   - ファイル名は「{取得日}_{文書番号}.xbrl」の形式とする

3. XBRLファイルをパースする
4. DBに格納する
5. ログ処理

    - 文書番号一覧を取得した日時
    - 取得した文書番号とその日時

### 実装方針

1, 2, 4 は単純な関数で実装する
3は拡張性を考えてクラスをつかって実装する
5はロガークラスを使って実装する

### テスト方針

都度、テストコードによる単体テストを実施する。
統合テストは実際にうごかし、データが取得されているか、データベースに必要なデータが保存されているか確認する。

## クラス一覧

- Docsクラス：Docクラスを持つ配列
- Docクラス：文書番号を主キーとし、発行会社、発行日等の情報を保有する
- Officersクラス:
  - 文書番号と並び順を主キー
  - 役員リスト（氏名、肩書き、生年月日、分類）
- Shareholdersクラス:
  - 文書番号と並び順を主キー
  - 大株主リスト（氏名、株数、保有割合、住所）
- XbrlParserクラス
  - 与えられたXBRLファイルを開く
  - 役員をパースする
  - 大株主の状況をパースする
- Loggerクラス
  - ログ処理に関して集約する

## エラー処理について

- API呼び出しは、10秒程度おいてリトライ
- ファイルやデータベース処理時は、エラーを吐き出し終了

## DB設計

- Docsテーブル：有報のIDや発行会社、提出日など
- Officersテーブル：有報のID,並び順を主キーに、役員監査役の情報
- Shareholdersテーブル：有報のID,並び順を主キーに、株主の情報
- 
## ログ処理

### フォーマット

"%(asctime)s [%(levelname)s] %(message)s"

### 保存先

ディレクトリ直下のlogフォルダ内に保存

## 非機能要件

### パフォーマンス

現時点では、考慮しない。今後、データ取得を非同期、バッチ処理等を検討する。

### セキュリティ

データは暗号化しない。APIキーやAPIエンドポイントは環境変数に格納して、取得する。

#### 環境変数

- EDINET_API_ENDPOINT_LIST (例: https://api.edinet-fsa.go.jp/api/v2/documents.json)
- EDINET_API_ENDPOINT_DOC (例: https://api.edinet-fsa.go.jp/api/v2/documents/{doc_id})
- EDINET_API_KEY （.envから読み込み）
